
name: Update README with Repositories

on:
  schedule:
    # ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® UTC ‡¶∏‡¶Æ‡¶Ø‡¶º 00:00 ‡¶è ‡¶ö‡¶≤‡¶¨‡ßá (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®)
    - cron: '0 0 * * *'
  workflow_dispatch: # ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®
  push:
    branches:
      - main

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Fetch Repositories and Update README
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            
            // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ GitHub username - ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
            const username = context.repo.owner;
            
            // ‡¶∏‡¶¨ public repositories fetch ‡¶ï‡¶∞‡ßÅ‡¶®
            const { data: repos } = await github.rest.repos.listForUser({
              username: username,
              sort: 'updated',
              per_page: 100,
              type: 'public'
            });
            
            // Profile repository ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶®
            const filteredRepos = repos.filter(repo => repo.name !== username);
            
            // Repository ‡¶ï‡¶æ‡¶∞‡ßç‡¶° HTML ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
            let projectsHtml = '<div align="center">\n\n';
            projectsHtml += '<h2>üóÇÔ∏è All My Projects</h2>\n\n';
            projectsHtml += '<table>\n';
            
            // 3 ‡¶ï‡¶≤‡¶æ‡¶Æ‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            for (let i = 0; i < filteredRepos.length; i += 3) {
              projectsHtml += '<tr>\n';
              
              for (let j = 0; j < 3; j++) {
                const repo = filteredRepos[i + j];
                
                if (repo) {
                  const description = repo.description || 'No description available';
                  const stars = repo.stargazers_count;
                  const forks = repo.forks_count;
                  const language = repo.language || 'Code';
                  
                  projectsHtml += `<td width="33%" align="center">
  <a href="${repo.html_url}" target="_blank">
    <img src="https://github-readme-stats.vercel.app/api/pin/?username=${username}&repo=${repo.name}&theme=tokyonight&hide_border=true" alt="${repo.name}"/>
  </a>
  <br/>
  <strong>${repo.name}</strong>
  <br/>
  <sub>${description.substring(0, 60)}${description.length > 60 ? '...' : ''}</sub>
  <br/>
  <img src="https://img.shields.io/github/stars/${username}/${repo.name}?style=social" alt="stars"/>
  <img src="https://img.shields.io/github/forks/${username}/${repo.name}?style=social" alt="forks"/>
</td>\n`;
                } else {
                  projectsHtml += '<td width="33%"></td>\n';
                }
              }
              
              projectsHtml += '</tr>\n';
            }
            
            projectsHtml += '</table>\n\n';
            projectsHtml += `<sub>Last Updated: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Dhaka', dateStyle: 'full', timeStyle: 'short' })}</sub>\n\n`;
            projectsHtml += '</div>\n';
            
            // README.md ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡ßÅ‡¶®
            let readme = fs.readFileSync('README.md', 'utf8');
            
            // PROJECTS_START ‡¶è‡¶¨‡¶Ç PROJECTS_END ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü replace ‡¶ï‡¶∞‡ßÅ‡¶®
            const startMarker = '<!-- PROJECTS_START -->';
            const endMarker = '<!-- PROJECTS_END -->';
            
            const startIndex = readme.indexOf(startMarker);
            const endIndex = readme.indexOf(endMarker);
            
            if (startIndex !== -1 && endIndex !== -1) {
              const before = readme.substring(0, startIndex + startMarker.length);
              const after = readme.substring(endIndex);
              readme = before + '\n' + projectsHtml + after;
            }
            
            // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ README.md ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®
            fs.writeFileSync('README.md', readme);
            
            console.log(`‚úÖ README updated with ${filteredRepos.length} repositories!`);
      
      - name: Commit and Push Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ü§ñ Auto-update: Repository cards updated" && git push)
